DELIMITER ;;

CREATE PROCEDURE ProcFetchUser_v1(
    IN valueUsername VARCHAR(64),
    IN valueEmail VARCHAR(256),
    IN valuePassword VARCHAR(512)
)
FetchUser:
BEGIN
    -- Değişken tanımlama, SHA512 şifrelemesi 128 karakter olduğu için şifreli metin 128 karakterdir
    DECLARE stored_encrypt_password VARCHAR(128);
    
    -- Kontroller
    IF valueUsername IS NULL OR valueEmail IS NULL OR valuePassword IS NULL THEN
        SELECT 'Kullanıcı Adı, E-posta Adresi veya Şifre Boş Olamaz!' AS message;
        LEAVE FetchUser;
    END IF;
    
    -- Gelen metni şifreleme türü ile oluşturmak
    SET stored_encrypt_password = SHA2(valuePassword, 512);
    
    -- Veritabanındaki Kullanıcı ile eşleiyorsa çıktı versin yoksa boş çıksın
    SELECT *
    FROM Users
    INNER JOIN Membership ON Users.usersMemberid = Membership.membershipId
    INNER JOIN Languages ON Users.usersLanguageid = Languages.languagesId
    INNER JOIN Verify ON Users.usersVerifyid = Verify.verifyId
    INNER JOIN Themes ON Users.usersThemeid = Themes.themesId
    WHERE usersUsername = valueUsername AND
    	usersEmail = valueEmail AND
    	usersPassword = stored_encrypt_password
    LIMIT 1 OFFSET 0;
END ;;

DELIMITER ;
